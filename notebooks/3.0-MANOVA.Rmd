--
title: "Univariate scatter plots"
output: html_notebook
---

```{r}
library(car)
library(heplots)
library(MASS)
library(ggplot2)
library(reshape2)
```

Prepare the data
```{r}
df <- read.csv('../data/processed/NYCQ_CCA_score_revision_yeo7nodes_4_0.8_0.5.csv', header = TRUE, sep = ',')
# reverse component 3 for intepretation
df$CC_03 <- df$CC_03 * -1
```
```{r}
# set the target
tasks <- data.matrix(df[,5:12])
questions <- data.matrix(df[,13:20])

colnames(tasks) <- colnames(df[,5:12])
colnames(questions) <- colnames(df[,13:20])

# reorder the tasks for presentation
tasks <- tasks[, c(1, 4, 5, 2, 3, 6, 7, 8)]
```
PCA
```{r}
task.pca <- prcomp(tasks, center = TRUE, scale. = TRUE)
plot(task.pca, type = "l")
task.pca <- prcomp(tasks, center = TRUE, scale. = TRUE, rank. = 1)
summary(task.pca)
melted<-cbind(colnames(tasks), melt(task.pca$rotation))
ggplot(melted)+geom_bar(aes(x=Var1, y=value), stat = "identity") + theme_classic()
task.pc <- task.pca$x
```


```{r}
question.pca <- prcomp(questions, center = TRUE, scale. = TRUE)
plot(question.pca, type = "l")
question.pca <- prcomp(questions, center = TRUE, scale. = TRUE, rank. = 1)
summary(question.pca)
melted<-cbind(colnames(questions), melt(question.pca$rotation))
ggplot(melted)+geom_bar(aes(x=Var1, y=value), stat = "identity") + theme_classic()
question.pc <- question.pca$x
```

```{r}
# DV-intellegence EV-Yeo 7 MANOVA
m1_task <- lm(task.pc ~ CC_01 + CC_02 + CC_03, data = df)
m1_ques <- lm(question.pc ~ CC_01 + CC_02 + CC_03, data = df)

# Parameter estimate
paraest <- summary(m1_task, test = "Pillai")

# attatch adjusted p and CI
p.raw<-paraest$coefficients[,4]
paraest$coefficients <- cbind(p.adjust(p.raw, "bonferroni"), confint(m1_task), paraest$coefficients)
colnames(paraest$coefficients)[1] <- "p.bonferroni"

print(paraest)

avPlots(lm(task.pc ~ CC_01 + CC_02 + CC_03 , data = df), ~ CC_01, 
        marginal.scale=TRUE, grid=FALSE, col.lines='black', pch=20)

avPlots(lm(task.pc ~ CC_01 + CC_02 + CC_03 , data = df), ~ CC_03, 
        marginal.scale=TRUE, grid=FALSE, col.lines='black', pch=20)
```
```{r}
# DV-intellegence EV-Yeo 7 MANOVA
m1_ques <- lm(question.pc ~ CC_01 + CC_02 + CC_03, data = df)

# Parameter estimate
paraest <- summary(m1_ques, test = "Pillai")
  
# attatch adjusted p and CI
p.raw<-paraest$coefficients[,4]
paraest$coefficients <- cbind(p.adjust(p.raw, "bonferroni"), confint(m1_ques), paraest$coefficients)
colnames(paraest$coefficients)[1] <- "p.bonferroni"

print(paraest)
```